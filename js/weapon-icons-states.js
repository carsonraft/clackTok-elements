window.WB = window.WB || {};

// ─── US States Weapon Icon Atlas ────────────────────────────────
// 30 hand-crafted SVG weapon icons rasterized into a 6x6 grid atlas
// (768x768, 128x128 per cell). Registers as atlas 1 on WB.WeaponSprites.
// States without SVGs keep their procedural draw() and generic circle+star icon.

WB.StatesIcons = {

    // ─── Grid layout: sprite key → [col, row] ──────────────
    GRID: {
        'alabama-rocket':       [0, 0],
        'arkansas-shard':       [1, 0],
        'florida-jaw':          [2, 0],
        'georgia-fizz':         [3, 0],
        'idaho-kernel':         [4, 0],
        'illinois-cutter':      [5, 0],
        'iowa-stalk':           [0, 1],
        'kansas-funnel':        [1, 1],
        'kentucky-barrel':      [2, 1],
        'maine-claw':           [3, 1],
        'maryland-claw':        [4, 1],
        'michigan-gear':        [5, 1],
        'minnesota-stick':      [0, 2],
        'minnesota-puck':       [1, 2],
        'mississippi-paddle':   [2, 2],
        'missouri-arch':        [3, 2],
        'montana-antler':       [4, 2],
        'nevada-slot':          [5, 2],
        'newyork-dart':         [0, 3],
        'newyork-terrain':      [1, 3],
        'ohio-football':        [2, 3],
        'oklahoma-turbine':     [3, 3],
        'oregon-log':           [4, 3],
        'pennsylvania-bell':    [5, 3],
        'rhodeisland-anchor':   [0, 4],
        'southcarolina-frond':  [1, 4],
        'texas-spur':           [2, 4],
        'utah-crystal':         [3, 4],
        'virginia-saber':       [4, 4],
        'westvirginia-pickaxe': [5, 4],
    },

    // ─── Weapon type → primary sprite key (30 states) ──────
    WEAPON_ICON: {
        'alabama':        'alabama-rocket',
        'arkansas':       'arkansas-shard',
        'florida':        'florida-jaw',
        'georgia':        'georgia-fizz',
        'idaho':          'idaho-kernel',
        'illinois':       'illinois-cutter',
        'iowa':           'iowa-stalk',
        'kansas':         'kansas-funnel',
        'kentucky':       'kentucky-barrel',
        'maine':          'maine-claw',
        'maryland':       'maryland-claw',
        'michigan':       'michigan-gear',
        'minnesota':      'minnesota-stick',
        'mississippi':    'mississippi-paddle',
        'missouri':       'missouri-arch',
        'montana':        'montana-antler',
        'nevada':         'nevada-slot',
        'new_york':       'newyork-dart',
        'ohio':           'ohio-football',
        'oklahoma':       'oklahoma-turbine',
        'oregon':         'oregon-log',
        'pennsylvania':   'pennsylvania-bell',
        'rhode_island':   'rhodeisland-anchor',
        'south_carolina': 'southcarolina-frond',
        'texas':          'texas-spur',
        'utah':           'utah-crystal',
        'virginia':       'virginia-saber',
        'west_virginia':  'westvirginia-pickaxe',
    },

    // ─── Secondary sprites for dual-icon states ─────────────
    PROJECTILE_ICON: {
        'minnesota':  'minnesota-puck',
        'new_york':   'newyork-terrain',
    },

    // ─── Atlas config ───────────────────────────────────────
    ATLAS_SIZE: 768,
    CELL_SIZE: 128,
    GRID_DIM: 6,

    // ─── SVG strings (inline, minified) ─────────────────────
    SVGS: {
'alabama-rocket': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .hull { fill: #FFFFFF; } .trim { fill: #D32F2F; } .window { fill: #81D4FA; } .flame { fill: #FFCA28; stroke: #D84315; stroke-width: 3; stroke-linejoin: round; } </style> </defs> <g id="rocket"> <path d="M 20 50 L 5 45 L 10 50 L 5 55 Z" class="flame" /> <path d="M 25 40 L 65 40 C 85 40, 95 50, 95 50 C 95 50, 85 60, 65 60 L 25 60 Z" class="outline hull" /> <path d="M 25 40 L 15 20 L 35 40 Z" class="outline trim" /> <path d="M 25 60 L 15 80 L 35 60 Z" class="outline trim" /> <path d="M 65 40 C 85 40, 95 50, 95 50 C 95 50, 85 60, 65 60 Z" class="outline trim" /> <rect x="20" y="44" width="8" height="12" class="outline" fill="#90A4AE" /> <circle cx="55" cy="50" r="6" class="outline window" /> </g> </svg>',
'arkansas-shard': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .d-dark { fill: #4DD0E1; } .d-mid { fill: #B2EBF2; } .d-light { fill: #E0F7FA; } .d-white { fill: #FFFFFF; } </style> </defs> <g id="classic-diamond"> <polygon points="35,20 65,20 85,45 50,90 15,45" class="outline d-dark" /> <polygon points="15,45 50,50 85,45 50,90" class="outline d-mid" /> <polygon points="35,20 65,20 50,50" class="outline d-white" /> <polygon points="15,45 35,20 50,50" class="outline d-light" /> <polygon points="65,20 85,45 50,50" class="outline d-light" /> <line x1="50" y1="50" x2="50" y2="90" class="outline" stroke-width="3" /> <polygon points="25,48 45,30 45,48" fill="#FFFFFF" /> </g> </svg>',
'florida-jaw': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .tooth { fill: #FFFFFF; stroke: #042A1D; stroke-width: 3.5; stroke-linejoin: round; stroke-linecap: round; } .jaw { fill: #00E676; } .accent { fill: #042A1D; } </style> </defs> <g id="bottom-jaw" transform="rotate(15, 20, 50)"> <polygon points="45,50 49,35 53,50" class="tooth" /> <polygon points="61,50 65,35 69,50" class="tooth" /> <polygon points="77,50 80,38 83,50" class="tooth" /> <path d="M 20 50 C 20 80, 50 85, 80 60 C 88 54, 91 52, 90 50 Z" class="outline jaw" /> </g> <g id="top-jaw" transform="rotate(-15, 20, 50)"> <polygon points="37,50 41,65 45,50" class="tooth" /> <polygon points="53,50 57,65 61,50" class="tooth" /> <polygon points="69,50 73,62 77,50" class="tooth" /> <polygon points="85,50 88,58 91,50" class="tooth" /> <path d="M 20 50 C 15 25, 30 15, 45 25 C 60 20, 80 25, 92 32 C 96 35, 96 45, 96 50 Z" class="outline jaw" /> <circle cx="85" cy="40" r="2.5" class="accent" /> <circle cx="42" cy="32" r="5" fill="#FFFFFF" class="outline" /> <circle cx="44" cy="32" r="2" class="accent" /> <line x1="33" y1="26" x2="51" y2="34" class="outline" stroke-width="5" /> </g> <circle cx="20" cy="50" r="6" class="outline accent" /> <circle cx="20" cy="50" r="2" fill="#FFFFFF" /> </svg>',
'georgia-fizz': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; } .bubble { fill: #8B4513; } .bubble-sm { fill: #D2B48C; } .highlight { fill: #FFFFFF; } </style> </defs> <g id="fizz-aura"> <circle cx="50" cy="50" r="38" fill="none" class="outline" stroke-width="2" stroke-dasharray="6 6" /> <circle cx="50" cy="12" r="8" class="outline bubble" /> <circle cx="88" cy="50" r="8" class="outline bubble" /> <circle cx="50" cy="88" r="8" class="outline bubble" /> <circle cx="12" cy="50" r="8" class="outline bubble" /> <circle cx="77" cy="23" r="5" class="outline bubble-sm" /> <circle cx="77" cy="77" r="5" class="outline bubble-sm" /> <circle cx="23" cy="77" r="5" class="outline bubble-sm" /> <circle cx="23" cy="23" r="5" class="outline bubble-sm" /> <circle cx="48" cy="9" r="2" class="highlight" /> <circle cx="86" cy="47" r="2" class="highlight" /> <circle cx="48" cy="85" r="2" class="highlight" /> <circle cx="10" cy="47" r="2" class="highlight" /> </g> </svg>',
'idaho-kernel': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .k-base { fill: #FFF59D; } .k-main { fill: #FFCA28; } .k-dark { fill: #FF8F00; } .k-light { fill: #FFE082; } </style> </defs> <g id="corn-kernel"> <path d="M 25 35 C 10 40, 10 60, 25 65 L 35 50 Z" class="outline k-base" /> <path d="M 25 35 C 50 20, 80 30, 85 50 C 80 70, 50 80, 25 65 C 35 55, 35 45, 25 35 Z" class="outline k-main" /> <path d="M 40 65 C 60 75, 78 65, 85 50 C 80 65, 55 70, 40 65 Z" fill="#FF8F00" /> <path d="M 35 40 C 50 30, 70 35, 75 45 C 65 38, 45 38, 35 40 Z" fill="#FFE082" /> </g> </svg>',
'illinois-cutter': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .metal { fill: #CFD8DC; } .metal-dark { fill: #90A4AE; } </style> </defs> <g id="saw-blade"> <polygon points="85.0,50.0 79.4,55.9 82.3,63.4 74.9,66.7 74.7,74.7 66.7,74.9 63.4,82.3 55.9,79.4 50.0,85.0 44.1,79.4 36.6,82.3 33.3,74.9 25.3,74.7 25.1,66.7 17.7,63.4 20.6,55.9 15.0,50.0 20.6,44.1 17.7,36.6 25.1,33.3 25.3,25.3 33.3,25.1 36.6,17.7 44.1,20.6 50.0,15.0 55.9,20.6 63.4,17.7 66.7,25.1 74.7,25.3 74.9,33.3 82.3,36.6 79.4,44.1" fill="#CFD8DC" class="outline" /> <circle cx="50" cy="50" r="24" class="outline metal-dark" /> <circle cx="50" cy="50" r="16" class="outline metal" /> <path d="M 35 35 C 45 25, 65 30, 65 40 C 65 45, 55 50, 50 45 C 45 40, 35 45, 35 35 Z" fill="#FFCA28" class="outline" /> <circle cx="58" cy="35" r="3.5" fill="#D84315" /> <circle cx="45" cy="40" r="2.5" fill="#D84315" /> <circle cx="50" cy="50" r="6" fill="#042A1D" /> <circle cx="50" cy="50" r="2" fill="#FFFFFF" /> </g> </svg>',
'iowa-stalk': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .husk-dark { fill: #689F38; } .husk-light { fill: #8BC34A; } .corn { fill: #FFEB3B; } </style> </defs> <g id="corn-stalk"> <path d="M 20 50 C 30 20, 70 20, 90 35 C 70 28, 45 35, 20 50 Z" class="outline husk-dark" /> <path d="M 20 50 C 30 80, 70 80, 90 65 C 70 72, 45 65, 20 50 Z" class="outline husk-dark" /> <path d="M 25 50 C 25 32, 85 35, 95 50 C 85 65, 25 68, 25 50 Z" class="outline corn" /> <path d="M 30 50 C 50 50, 70 50, 92 50" fill="none" class="outline" stroke-width="3" /> <path d="M 35 43 C 50 42, 70 43, 85 45" fill="none" class="outline" stroke-width="3" /> <path d="M 35 57 C 50 58, 70 57, 85 55" fill="none" class="outline" stroke-width="3" /> <path d="M 45 40 L 45 60" fill="none" class="outline" stroke-width="3" /> <path d="M 60 38 L 60 62" fill="none" class="outline" stroke-width="3" /> <path d="M 75 41 L 75 59" fill="none" class="outline" stroke-width="3" /> <path d="M 15 50 C 25 38, 50 38, 65 50 C 50 55, 30 55, 15 50 Z" class="outline husk-light" /> <path d="M 15 50 C 25 62, 50 62, 65 50 C 50 45, 30 45, 15 50 Z" class="outline husk-light" /> <circle cx="20" cy="50" r="8" fill="#042A1D" /> <circle cx="20" cy="50" r="3" fill="#FFFFFF" /> </g> </svg>',
'kansas-funnel': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .wind-dark { fill: #26C6DA; } .wind-mid { fill: #80DEEA; } .wind-light { fill: #E0F7FA; } </style> </defs> <g id="wind-vortex"> <path d="M 28 30 C 50 15, 75 10, 90 20" fill="none" class="outline" stroke-width="4" stroke-dasharray="8 6" /> <path d="M 28 70 C 50 85, 75 90, 90 80" fill="none" class="outline" stroke-width="4" stroke-dasharray="6 8" /> <ellipse cx="24" cy="50" rx="6" ry="12" class="outline wind-dark" /> <ellipse cx="32" cy="50" rx="7" ry="16" class="outline wind-light" /> <ellipse cx="42" cy="50" rx="8" ry="21" class="outline wind-mid" /> <ellipse cx="53" cy="50" rx="9" ry="27" class="outline wind-light" /> <ellipse cx="65" cy="50" rx="10" ry="34" class="outline wind-dark" /> <ellipse cx="78" cy="50" rx="11" ry="42" class="outline wind-mid" /> <ellipse cx="92" cy="50" rx="12" ry="48" class="outline wind-light" /> <ellipse cx="92" cy="50" rx="4" ry="30" fill="#042A1D" /> <circle cx="70" cy="18" r="3" fill="#042A1D" /> <circle cx="50" cy="82" r="2.5" fill="#042A1D" /> <circle cx="85" cy="85" r="2" fill="#042A1D" /> <circle cx="20" cy="50" r="8" fill="#042A1D" /> <circle cx="20" cy="50" r="3" fill="#FFFFFF" /> </g> </svg>',
'kentucky-barrel': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .wood { fill: #8D6E63; } .wood-dark { fill: #5D4037; } .metal { fill: #B0BEC5; } </style> </defs> <g id="bourbon-barrel"> <line x1="20" y1="50" x2="35" y2="50" class="outline" stroke-width="6" /> <path d="M 35 25 Q 60 15 85 25 L 85 75 Q 60 85 35 75 Z" class="outline wood" /> <path d="M 35 38 Q 60 30 85 38" fill="none" stroke="#5D4037" stroke-width="2" /> <path d="M 35 50 Q 60 46 85 50" fill="none" stroke="#5D4037" stroke-width="2" /> <path d="M 35 62 Q 60 62 85 62" fill="none" stroke="#5D4037" stroke-width="2" /> <path d="M 47 21 Q 44 50 47 79" fill="none" class="outline metal" stroke-width="4" /> <path d="M 73 21 Q 70 50 73 79" fill="none" class="outline metal" stroke-width="4" /> <ellipse cx="35" cy="50" rx="5" ry="25" class="outline wood-dark" /> <path d="M 85 25 A 5 25 0 0 1 85 75" fill="none" class="outline" /> <circle cx="60" cy="21" r="3" fill="#042A1D" /> <circle cx="20" cy="50" r="6" fill="#042A1D" /> <circle cx="20" cy="50" r="2" fill="#FFFFFF" /> </g> </svg>',
'maine-claw': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .shell { fill: #E53935; } .shell-dark { fill: #C62828; } .teeth { fill: #FFCDD2; } </style> </defs> <g id="lobster-projectile"> <path d="M 8 46 C 15 40, 20 40, 24 43 L 24 67 C 20 70, 15 70, 8 64 C 4 60, 4 50, 8 46 Z" class="outline shell-dark" /> <path d="M 22 42 C 20 10, 70 15, 85 30 C 95 40, 95 55, 80 55 C 65 55, 55 45, 45 45 C 38 45, 35 48, 35 52 C 45 55, 60 62, 70 70 C 80 78, 75 90, 60 85 C 45 78, 30 78, 22 68 C 15 58, 15 50, 22 42 Z" class="outline shell" /> <path d="M 35 52 C 30 60, 28 65, 22 68" fill="none" class="outline" /> <circle cx="68" cy="51" r="3.5" class="outline teeth" /> <circle cx="56" cy="48" r="3" class="outline teeth" /> <circle cx="46" cy="46" r="2.5" class="outline teeth" /> <circle cx="45" cy="56" r="2.5" class="outline teeth" /> <circle cx="55" cy="62" r="3" class="outline teeth" /> <circle cx="65" cy="68" r="3.5" class="outline teeth" /> <circle cx="30" cy="52" r="2" fill="#C62828" /> <circle cx="36" cy="40" r="1.5" fill="#C62828" /> <circle cx="26" cy="48" r="1.5" fill="#C62828" /> </g> </svg>',
'maryland-claw': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .shell { fill: #E53935; } .shell-dark { fill: #B71C1C; } .shell-light { fill: #FFCDD2; } </style> </defs> <g id="crab-claw"> <path d="M 15 40 L 40 35 L 45 65 L 15 60 Z" class="outline shell-dark" /> <path d="M 35 55 C 60 80, 90 70, 95 55 C 80 60, 60 60, 45 45 Z" class="outline shell" /> <path d="M 35 45 C 50 15, 95 20, 90 45 C 80 35, 65 35, 45 55 Z" class="outline shell" /> <polygon points="55,42 60,48 65,42" class="outline shell-light" /> <polygon points="70,39 75,45 80,41" class="outline shell-light" /> <polygon points="60,57 65,51 70,58" class="outline shell-light" /> <polygon points="75,59 80,54 85,58" class="outline shell-light" /> <circle cx="40" cy="50" r="6" class="outline shell-dark" /> <circle cx="20" cy="50" r="6" fill="#042A1D" class="outline" /> <circle cx="20" cy="50" r="2" fill="#FFFFFF" /> </g> </svg>',
'michigan-gear': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .gear-base { fill: #78909C; } .gear-highlight { fill: #B0BEC5; } .gear-shadow { fill: #455A64; } </style> </defs> <g id="planetary-gear"> <path d="M 42 4 L 58 4 L 62 16 L 74 20 L 84 10 L 94 20 L 86 32 L 88 42 L 98 46 L 98 54 L 88 58 L 86 68 L 94 80 L 84 90 L 74 80 L 62 84 L 58 96 L 42 96 L 38 84 L 26 80 L 16 90 L 6 80 L 14 68 L 12 58 L 2 54 L 2 46 L 12 42 L 14 32 L 6 20 L 16 10 L 26 20 L 38 16 Z" class="outline gear-shadow" /> <circle cx="50" cy="50" r="36" class="outline gear-base" /> <circle cx="50" cy="50" r="28" fill="none" class="outline" /> <path d="M 50 14 L 50 22 M 50 78 L 50 86 M 14 50 L 22 50 M 78 50 L 86 50" class="outline" stroke-width="4" /> <circle cx="50" cy="50" r="31" class="gear-highlight" fill="none" stroke-width="2" /> <circle cx="30" cy="30" r="4" class="outline gear-highlight" /> <circle cx="70" cy="30" r="4" class="outline gear-highlight" /> <circle cx="30" cy="70" r="4" class="outline gear-highlight" /> <circle cx="70" cy="70" r="4" class="outline gear-highlight" /> </g> </svg>',
'minnesota-stick': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .wood { fill: #FFECB3; } .tape { stroke: #212121; stroke-width: 3; stroke-linecap: round; } </style> </defs> <g id="hockey-stick"> <path d="M 20 46 L 68 46 C 75 46, 80 48, 85 58 L 90 68 C 92 72, 88 76, 84 74 L 74 58 C 70 54, 68 54, 65 54 L 20 54 Z" class="outline wood" /> <path d="M 20 46 L 40 46 L 40 54 L 20 54 Z" fill="#212121" class="outline" /> <line x1="25" y1="46" x2="22" y2="54" class="tape" stroke-width="2" stroke="#FFFFFF" /> <line x1="30" y1="46" x2="27" y2="54" class="tape" stroke-width="2" stroke="#FFFFFF" /> <line x1="35" y1="46" x2="32" y2="54" class="tape" stroke-width="2" stroke="#FFFFFF" /> <line x1="75" y1="50" x2="71" y2="56" class="tape" /> <line x1="79" y1="55" x2="75" y2="61" class="tape" /> <line x1="83" y1="61" x2="79" y2="67" class="tape" /> <line x1="87" y1="68" x2="83" y2="73" class="tape" /> <circle cx="20" cy="50" r="6" fill="#042A1D" class="outline" /> <circle cx="20" cy="50" r="2" fill="#FFFFFF" /> </g> </svg>',
'minnesota-puck': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .p-top { fill: #424242; } .p-side { fill: #212121; } .p-logo { stroke: #1976D2; stroke-width: 3; stroke-linecap: round; fill: none; } </style> </defs> <g id="hockey-puck"> <path d="M 10 45 L 10 60 A 40 32 0 0 0 90 60 L 90 45 Z" class="outline p-side" /> <ellipse cx="50" cy="45" rx="40" ry="32" class="outline p-top" /> <ellipse cx="50" cy="45" rx="30" ry="24" fill="none" stroke="#616161" stroke-width="2" /> <line x1="50" y1="28" x2="50" y2="62" class="p-logo" /> <line x1="33" y1="45" x2="67" y2="45" class="p-logo" /> <line x1="38" y1="35" x2="62" y2="55" class="p-logo" /> <line x1="38" y1="55" x2="62" y2="35" class="p-logo" /> </g> </svg>',
'mississippi-paddle': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .wood { fill: #8D6E63; } .iron { fill: none; stroke: #D32F2F; stroke-width: 4; } </style> </defs> <g id="paddle-wheel"> <circle cx="50" cy="50" r="8" fill="#D32F2F" class="outline" /> <circle cx="50" cy="50" r="3" fill="#FFFFFF" /> <g class="iron" stroke-width="3"> <line x1="50" y1="50" x2="80" y2="50" transform="rotate(0 50 50)" /> <line x1="50" y1="50" x2="80" y2="50" transform="rotate(30 50 50)" /> <line x1="50" y1="50" x2="80" y2="50" transform="rotate(60 50 50)" /> <line x1="50" y1="50" x2="80" y2="50" transform="rotate(90 50 50)" /> <line x1="50" y1="50" x2="80" y2="50" transform="rotate(120 50 50)" /> <line x1="50" y1="50" x2="80" y2="50" transform="rotate(150 50 50)" /> <line x1="50" y1="50" x2="80" y2="50" transform="rotate(180 50 50)" /> <line x1="50" y1="50" x2="80" y2="50" transform="rotate(210 50 50)" /> <line x1="50" y1="50" x2="80" y2="50" transform="rotate(240 50 50)" /> <line x1="50" y1="50" x2="80" y2="50" transform="rotate(270 50 50)" /> <line x1="50" y1="50" x2="80" y2="50" transform="rotate(300 50 50)" /> <line x1="50" y1="50" x2="80" y2="50" transform="rotate(330 50 50)" /> </g> <g class="outline wood"> <rect x="70" y="44" width="22" height="12" rx="2" transform="rotate(0 50 50)" /> <rect x="70" y="44" width="22" height="12" rx="2" transform="rotate(30 50 50)" /> <rect x="70" y="44" width="22" height="12" rx="2" transform="rotate(60 50 50)" /> <rect x="70" y="44" width="22" height="12" rx="2" transform="rotate(90 50 50)" /> <rect x="70" y="44" width="22" height="12" rx="2" transform="rotate(120 50 50)" /> <rect x="70" y="44" width="22" height="12" rx="2" transform="rotate(150 50 50)" /> <rect x="70" y="44" width="22" height="12" rx="2" transform="rotate(180 50 50)" /> <rect x="70" y="44" width="22" height="12" rx="2" transform="rotate(210 50 50)" /> <rect x="70" y="44" width="22" height="12" rx="2" transform="rotate(240 50 50)" /> <rect x="70" y="44" width="22" height="12" rx="2" transform="rotate(270 50 50)" /> <rect x="70" y="44" width="22" height="12" rx="2" transform="rotate(300 50 50)" /> <rect x="70" y="44" width="22" height="12" rx="2" transform="rotate(330 50 50)" /> </g> <circle cx="50" cy="50" r="40" class="outline iron" /> <circle cx="50" cy="50" r="25" class="outline iron" /> </g> </svg>',
'missouri-arch': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .metal-base { fill: #CFD8DC; } .bracket { fill: #455A64; } </style> </defs> <g id="arch-blade"> <path d="M 20 15 C 65 15, 92 30, 92 50 C 92 70, 65 85, 20 85 L 20 65 C 55 65, 80 60, 80 50 C 80 40, 55 35, 20 35 Z" class="outline metal-base" /> <path d="M 20 20 C 60 20, 86 33, 86 50 C 86 67, 60 80, 20 80 L 20 73 C 55 73, 76 62, 76 50 C 76 38, 55 27, 20 27 Z" fill="#FFFFFF" /> <path d="M 20 25 C 60 25, 82 35, 82 50 C 82 65, 60 75, 20 75" fill="none" stroke="#90A4AE" stroke-width="2" /> <rect x="12" y="12" width="12" height="76" rx="3" class="outline bracket" /> <circle cx="18" cy="20" r="2" fill="#042A1D" /> <circle cx="18" cy="80" r="2" fill="#042A1D" /> <circle cx="20" cy="50" r="8" fill="#042A1D" class="outline" /> <circle cx="20" cy="50" r="3" fill="#FFFFFF" /> </g> </svg>',
'montana-antler': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .bone { fill: #E6D5C3; } .bone-detail { stroke: #BCAAA4; stroke-width: 2.5; stroke-linecap: round; fill: none; } </style> </defs> <g id="moose-antler"> <path d="M 20 48 C 30 48, 32 38, 35 25 C 38 10, 48 5, 55 15 C 52 28, 58 35, 68 20 C 65 38, 72 45, 85 30 C 80 50, 88 55, 95 70 C 82 82, 60 90, 40 75 C 30 65, 25 52, 20 52 Z" class="outline bone" /> <path d="M 38 45 Q 55 30, 70 25" class="bone-detail" /> <path d="M 42 50 Q 65 48, 82 45" class="bone-detail" /> <path d="M 40 58 Q 55 75, 75 80" class="bone-detail" /> <path d="M 15 42 Q 22 40, 24 50 Q 22 60, 15 58 Z" fill="#6D4C41" class="outline" /> <circle cx="20" cy="50" r="4" fill="#042A1D" /> <circle cx="20" cy="50" r="1.5" fill="#FFFFFF" /> </g> </svg>',
'nevada-slot': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .metal-base { fill: #90A4AE; } .metal-arm { fill: #CFD8DC; } .red-knob { fill: #E53935; } .knob-highlight { fill: none; stroke: #FFFFFF; stroke-width: 3; stroke-linecap: round; } </style> </defs> <g id="slot-arm"> <rect x="20" y="44" width="55" height="12" class="outline metal-arm" /> <circle cx="20" cy="50" r="16" class="outline metal-base" /> <path d="M 12 50 A 8 8 0 0 1 28 50" fill="none" class="outline" stroke-width="3" /> <circle cx="82" cy="50" r="13" class="outline red-knob" /> <path d="M 77 43 A 6 6 0 0 1 87 45" class="knob-highlight" /> <circle cx="20" cy="50" r="6" fill="#042A1D" class="outline" /> <circle cx="20" cy="50" r="2" fill="#FFFFFF" /> </g> </svg>',
'newyork-dart': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .steel { fill: #CFD8DC; } .steel-mid { fill: #90A4AE; } .steel-dark { fill: #546E7A; } .glass { fill: #FFCA28; } </style> </defs> <g id="deco-dart"> <rect x="8" y="38" width="12" height="24" class="outline steel-dark" /> <line x1="12" y1="38" x2="12" y2="62" class="outline" stroke-width="2" /> <line x1="16" y1="38" x2="16" y2="62" class="outline" stroke-width="2" /> <polygon points="20,28 50,34 50,66 20,72" class="outline steel-mid" /> <polygon points="20,28 50,34 50,50 20,50" class="outline steel" /> <polygon points="50,34 65,38 65,62 50,66" class="outline steel-mid" /> <polygon points="50,34 65,38 65,50 50,50" class="outline steel" /> <path d="M 65 38 C 75 38, 75 62, 65 62 Z" class="outline steel-dark" /> <path d="M 65 42 C 72 42, 72 58, 65 58 Z" class="outline steel-mid" /> <path d="M 65 46 C 68 46, 68 54, 65 54 Z" class="outline glass" /> <polygon points="73,48 95,50 73,52" class="outline steel" /> <line x1="28" y1="42" x2="44" y2="42" class="outline glass" stroke-width="3" /> <line x1="28" y1="50" x2="44" y2="50" class="outline glass" stroke-width="3" /> <line x1="28" y1="58" x2="44" y2="58" class="outline glass" stroke-width="3" /> <line x1="54" y1="44" x2="61" y2="44" class="outline glass" stroke-width="2" /> <line x1="54" y1="56" x2="61" y2="56" class="outline glass" stroke-width="2" /> </g> </svg>',
'newyork-terrain': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .stone-light { fill: #CFD8DC; } .stone-mid { fill: #90A4AE; } .stone-dark { fill: #546E7A; } .glass { fill: #FFCA28; } .ground { fill: #37474F; } </style> </defs> <g id="empire-skyscraper-terrain"> <line x1="50" y1="6" x2="50" y2="16" class="outline" stroke-width="4" /> <rect x="46" y="16" width="8" height="10" class="outline stone-light" /> <rect x="50" y="16" width="4" height="10" class="outline stone-mid" /> <rect x="42" y="26" width="16" height="10" class="outline stone-light" /> <rect x="50" y="26" width="8" height="10" class="outline stone-mid" /> <rect x="36" y="36" width="28" height="40" class="outline stone-light" /> <rect x="50" y="36" width="14" height="40" class="outline stone-mid" /> <rect x="28" y="76" width="44" height="15" class="outline stone-light" /> <rect x="50" y="76" width="22" height="15" class="outline stone-mid" /> <line x1="42" y1="42" x2="42" y2="70" class="outline glass" stroke-width="2" /> <line x1="58" y1="42" x2="58" y2="70" class="outline glass" stroke-width="2" /> <line x1="50" y1="42" x2="50" y2="70" class="outline glass" stroke-width="2" /> <line x1="34" y1="81" x2="34" y2="87" class="outline glass" stroke-width="2" /> <line x1="66" y1="81" x2="66" y2="87" class="outline glass" stroke-width="2" /> <path d="M 5 95 L 18 80 L 28 88 L 40 82 L 50 86 L 60 82 L 72 88 L 82 80 L 95 95 Z" class="outline ground" /> </g> </svg>',
'ohio-football': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .o-red { fill: #D32F2F; } .o-blue { fill: #1976D2; } .o-white { fill: #FFFFFF; } .lace { stroke: #FFFFFF; stroke-width: 3; stroke-linecap: round; } </style> </defs> <g id="ohio-football"> <path d="M 10 50 C 25 20, 75 20, 90 50 C 75 80, 25 80, 10 50 Z" class="outline o-red" /> <path d="M 10 50 C 20 35, 30 25, 45 22 L 45 78 C 30 75, 20 65, 10 50 Z" class="outline o-blue" /> <circle cx="30" cy="50" r="9" class="outline o-white" /> <circle cx="30" cy="50" r="4" class="outline o-red" /> <path d="M 72 26 Q 77 50 72 74" fill="none" class="outline o-white" stroke-width="5" /> <line x1="48" y1="34" x2="65" y2="34" class="lace" /> <line x1="51" y1="30" x2="51" y2="38" class="lace" /> <line x1="56" y1="30" x2="56" y2="38" class="lace" /> <line x1="61" y1="30" x2="61" y2="38" class="lace" /> </g> </svg>',
'oklahoma-turbine': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .turbine { fill: #ECEFF1; } .hub { fill: #CFD8DC; } </style> </defs> <g id="wind-turbine"> <line x1="20" y1="50" x2="60" y2="50" class="outline" stroke-width="8" /> <g transform="translate(58, 50)"> <path d="M -6 -6 C -18 -35, -5 -45, 0 -45 C 5 -45, 8 -20, 6 -6 Z" class="outline turbine" /> <path d="M -6 -6 C -18 -35, -5 -45, 0 -45 C 5 -45, 8 -20, 6 -6 Z" class="outline turbine" transform="rotate(120)" /> <path d="M -6 -6 C -18 -35, -5 -45, 0 -45 C 5 -45, 8 -20, 6 -6 Z" class="outline turbine" transform="rotate(240)" /> <circle cx="0" cy="0" r="8" class="outline hub" /> </g> <circle cx="20" cy="50" r="6" fill="#042A1D" class="outline" /> <circle cx="20" cy="50" r="2" fill="#FFFFFF" /> </g> </svg>',
'oregon-log': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .bark { fill: #6D4C41; } .wood { fill: #FFCC80; } </style> </defs> <g id="fir-log"> <path d="M 15 35 L 80 35 L 95 50 L 80 65 L 15 65 Z" class="outline wood" /> <path d="M 15 35 L 70 35 L 75 50 L 70 65 L 15 65 Z" class="outline bark" /> <polygon points="30,35 35,30 40,35" class="outline bark" /> <polygon points="55,35 60,31 65,35" class="outline bark" /> <polygon points="25,65 30,69 35,65" class="outline bark" /> <polygon points="50,65 55,70 60,65" class="outline bark" /> <line x1="20" y1="43" x2="40" y2="43" class="outline" stroke-width="3" /> <line x1="48" y1="43" x2="65" y2="43" class="outline" stroke-width="3" /> <line x1="25" y1="51" x2="55" y2="51" class="outline" stroke-width="3" /> <line x1="60" y1="51" x2="68" y2="51" class="outline" stroke-width="3" /> <line x1="30" y1="59" x2="45" y2="59" class="outline" stroke-width="3" /> <line x1="53" y1="59" x2="65" y2="59" class="outline" stroke-width="3" /> <line x1="75" y1="40" x2="95" y2="50" class="outline" stroke-width="2.5" /> <line x1="78" y1="50" x2="95" y2="50" class="outline" stroke-width="2.5" /> <line x1="75" y1="60" x2="95" y2="50" class="outline" stroke-width="2.5" /> <circle cx="20" cy="50" r="6" fill="#042A1D" class="outline" /> <circle cx="20" cy="50" r="2" fill="#FFFFFF" /> </g> </svg>',
'pennsylvania-bell': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .bronze { fill: #BCAAA4; } .bronze-dark { fill: #8D6E63; } .wood { fill: #795548; } .iron { fill: #455A64; } </style> </defs> <g id="liberty-bell"> <circle cx="86" cy="50" r="7" class="outline iron" /> <path d="M 32 35 C 50 35, 65 35, 75 20 Q 78 16, 82 16 L 82 84 Q 78 84, 75 80 C 65 65, 50 65, 32 65 Z" class="outline bronze" /> <path d="M 78 16 L 82 16 L 82 84 L 78 84 Z" class="outline bronze-dark" /> <path d="M 78 55 L 72 53 L 67 58 L 60 50" fill="none" class="outline" stroke-width="3" /> <rect x="14" y="25" width="16" height="50" rx="4" class="outline wood" /> <circle cx="22" cy="32" r="2.5" fill="#042A1D" /> <circle cx="22" cy="68" r="2.5" fill="#042A1D" /> <circle cx="20" cy="50" r="6" fill="#042A1D" class="outline" /> <circle cx="20" cy="50" r="2" fill="#FFFFFF" /> </g> </svg>',
'rhodeisland-anchor': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .iron { fill: #78909C; } .iron-dark { fill: #546E7A; } .wood { fill: #8D6E63; } </style> </defs> <g id="ship-anchor"> <path d="M 60 20 C 95 20, 95 80, 60 80" fill="none" stroke="#042A1D" stroke-width="12" stroke-linecap="round" /> <path d="M 60 20 C 95 20, 95 80, 60 80" fill="none" stroke="#78909C" stroke-width="4" stroke-linecap="round" /> <polygon points="65,10 45,20 65,30" class="outline iron" /> <polygon points="65,70 45,80 65,90" class="outline iron" /> <rect x="25" y="46" width="60" height="8" class="outline iron" /> <rect x="32" y="20" width="8" height="60" rx="3" class="outline wood" /> <rect x="27" y="45" width="18" height="10" class="outline iron-dark" /> <circle cx="20" cy="50" r="12" class="outline iron" /> <circle cx="20" cy="50" r="6" fill="#042A1D" /> <circle cx="20" cy="50" r="2" fill="#FFFFFF" /> </g> </svg>',
'southcarolina-frond': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .stem { fill: #8D6E63; } .leaf { fill: #4CAF50; } .leaf-dark { fill: #388E3C; } .vein { fill: none; stroke: #1B5E20; stroke-width: 2.5; stroke-linecap: round; } </style> </defs> <g id="palmetto-frond"> <rect x="15" y="46" width="30" height="8" rx="2" class="outline stem" /> <path d="M 40 40 C 48 40, 48 60, 40 60 Z" class="outline leaf-dark" /> <path d="M 45 50 L 65 15 L 72 25 L 82 20 L 82 32 L 95 38 L 88 45 L 98 50 L 88 55 L 95 62 L 82 68 L 82 80 L 72 75 L 65 85 Z" class="outline leaf" /> <path d="M 45 50 L 68 20 M 45 50 L 80 26 M 45 50 L 90 40 M 45 50 L 92 50 M 45 50 L 90 60 M 45 50 L 80 74 M 45 50 L 68 80" class="vein" /> <circle cx="20" cy="50" r="6" fill="#042A1D" class="outline" /> <circle cx="20" cy="50" r="2" fill="#FFFFFF" /> </g> </svg>',
'texas-spur': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .steel { fill: #B0BEC5; } </style> </defs> <g id="texas-spur"> <path d="M 20 40 C 40 40, 50 45, 60 50 C 50 55, 40 60, 20 60" fill="none" class="outline" /> <g transform="translate(70, 50)"> <polygon points="0,-25 7,-7 24,-7 10,4 15,21 0,11 -15,21 -10,4 -24,-7 -7,-7" class="outline steel" /> <circle cx="0" cy="0" r="5" class="outline" fill="#90A4AE" /> </g> <circle cx="20" cy="50" r="6" fill="#042A1D" /> </g> </svg>',
'utah-crystal': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .c-light { fill: #FFFFFF; } .c-mid { fill: #E0F7FA; } .c-dark { fill: #B2EBF2; } </style> </defs> <g id="salt-cluster"> <path d="M 20 50 L 45 15 L 70 30 Z" class="outline c-mid" /> <path d="M 20 50 L 70 30 L 50 45 Z" class="outline c-dark" /> <path d="M 20 50 L 75 70 L 55 85 Z" class="outline c-dark" /> <path d="M 20 50 L 50 55 L 75 70 Z" class="outline c-mid" /> <path d="M 20 50 L 60 35 L 95 50 Z" class="outline c-light" /> <path d="M 20 50 L 60 65 L 95 50 Z" class="outline c-mid" /> <circle cx="20" cy="50" r="6" fill="#042A1D" class="outline" /> <circle cx="20" cy="50" r="2" fill="#FFFFFF" /> </g> </svg>',
'virginia-saber': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .blade { fill: #CFD8DC; } </style> </defs> <g id="saber"> <path d="M 35 45 L 95 48 Q 60 58, 35 58 Z" class="outline blade" /> <path d="M 35 38 C 15 38, 15 62, 35 62 Z" class="outline" fill="#FFA000" /> <circle cx="20" cy="50" r="6" fill="#042A1D" /> </g> </svg>',
'westvirginia-pickaxe': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"> <defs> <style> .outline { stroke: #042A1D; stroke-width: 4; stroke-linejoin: round; stroke-linecap: round; } .wood { fill: #8D6E63; } .iron { fill: #90A4AE; } </style> </defs> <g id="pickaxe"> <rect x="15" y="44" width="60" height="12" rx="2" class="outline wood" /> <line x1="25" y1="48" x2="65" y2="48" class="outline" stroke-width="2.5" /> <line x1="30" y1="52" x2="70" y2="52" class="outline" stroke-width="2.5" /> <path d="M 65 15 Q 95 50 65 85 Q 80 50 65 15 Z" class="outline iron" /> <rect x="68" y="42" width="6" height="16" class="outline iron" /> <circle cx="20" cy="50" r="6" fill="#042A1D" class="outline" /> <circle cx="20" cy="50" r="2" fill="#FFFFFF" /> </g> </svg>',
    },

    // ─── Atlas Builder ───────────────────────────────────────

    init() {
        if (!WB.WeaponSprites || !WB.WeaponSprites._program) {
            console.warn('[StatesIcons] WeaponSprites not ready, retrying in 500ms');
            setTimeout(() => this.init(), 500);
            return;
        }

        var keys = Object.keys(this.GRID);
        var loaded = 0;
        var total = keys.length;
        var canvas = document.createElement('canvas');
        canvas.width = this.ATLAS_SIZE;
        canvas.height = this.ATLAS_SIZE;
        var ctx = canvas.getContext('2d');

        // Clear to transparent
        ctx.clearRect(0, 0, this.ATLAS_SIZE, this.ATLAS_SIZE);

        keys.forEach(function(key) {
            var pos = this.GRID[key];
            var svgStr = this.SVGS[key];
            if (!svgStr) {
                loaded++;
                if (loaded === total) this._finalize(canvas);
                return;
            }

            var img = new Image();
            img.onload = function() {
                var x = pos[0] * this.CELL_SIZE;
                var y = pos[1] * this.CELL_SIZE;
                ctx.drawImage(img, x, y, this.CELL_SIZE, this.CELL_SIZE);
                loaded++;
                if (loaded === total) this._finalize(canvas);
            }.bind(this);
            img.onerror = function() {
                console.warn('[StatesIcons] Failed to load SVG: ' + key);
                loaded++;
                if (loaded === total) this._finalize(canvas);
            }.bind(this);

            // Data URI approach: no fetch, no CORS, no blob
            img.src = 'data:image/svg+xml,' + encodeURIComponent(svgStr);
        }.bind(this));
    },

    _finalize(canvas) {
        // Register as atlas 1 (states) with 6x6 grid
        WB.WeaponSprites.registerAtlas(1, canvas, this.GRID, this.GRID_DIM);
        console.log('[StatesIcons] Atlas built and registered (' +
            Object.keys(this.GRID).length + ' sprites, ' +
            this.ATLAS_SIZE + 'x' + this.ATLAS_SIZE + ')');
    },
};
